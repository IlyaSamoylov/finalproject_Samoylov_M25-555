# Проект 3 - CLI приложение: имитация валютного кошелька

![Python](https://img.shields.io/badge/Python-3.12-blue)
![Poetry](https://img.shields.io/badge/Poetry-управление_зависимостями-orange)

Это комплексная платформа, которая позволяет пользователям регистрироваться, управлять своим виртуальным портфелем фиатных и криптовалют, совершать сделки по покупке/продаже, а также отслеживать актуальные курсы в реальном времени. Система состоит из двух основных сервисов:

1. _Сервис Парсинга_ (Parser Service): сервис, который по запросу или расписанию обращается к публичным API, получает актуальные курсы, сравнивает их с предыдущими значениями и сохраняет историю в файловое хранилище.

2. _Основной Сервис_ (Core Service): Главное приложение, которое предоставляет пользовательский интерфейс (CLI), управляет пользователями, их кошельками, историей транзакций и взаимодействует с сервисом парсинга для получения актуальных курсов.

## Источники курсов и API

Обновление курсов выполняется отдельным сервисом парсинга (Parser Service),
который обращается к публичным внешним API.

На данный момент поддерживаются следующие источники:

- _CoinGecko_: используется для получения курсов криптовалют и не требует API ключ
- _ExchangeRate API_: используется для фиатных валют, требует API-ключ

### Настройка API-ключей

Для обновления фиатных курсов через ExchangeRate API необходимо указать API-ключ. Получить его можно, зарегистрировавшись на [сайте](https://www.exchangerate-api.com/).

Приложение поддерживает **два способа хранения ключа**.
#### Способ 1. Файл с секретом 
В корне проекта создайте `.secret/EXCHANGERATE_API_KEY.txt`, положите в него ключ:
```
<ваш API ключ>
```
#### Способ 2. Переменная среды
Для этого можно:

##### Linux/macOS
```
export EXCHANGERATE_API_KEY=<ваш API-ключ>
```
##### Windows
```
setx EXCHANGERATE_API_KEY "<ваш API-ключ>"
```
## Установка и запуск

## Быстрый старт

### Предварительные требования

- Python 3.12 или выше
- Poetry (менеджер зависимостей)

### Установка

1. **Клонируйте репозиторий:**
   ```bash
   git clone https://github.com/IlyaSamoylov/finalproject_Samoylov_M25-555
   cd finalproject_Samoylov_M25-555
   ```

2. **Установите poetry (если не установлен)**
   ### Windows
   pip install poetry

   ### Linux/macOS
   sudo apt install python3-poetry

3. **Настройте poetry, чтобы он создавал виртуальные окружения в директории проекта**
  ```bash
   poetry config virtualenvs.in-project true  
  ```
4. **Установите зависимости проекта**
  ```bash
  poetry install
  ```
  или 
  ```bash
  make install
  ```
5. **Активируйте виртуальное окружение**
  ### Linux
  ```bash
  source .venv/bin/activate
  ```
  ### Windows
  ```bash
  source .venv/Scripts/activate
  ```
6. **Начните использовать**
   ## через make:
   ```bash
    make project
   ```
   ## через poetry:
   ```bash
   poetry run project
   ```

## Доступные команды (usecases):


| Команда                                                | Описание                                                          |
| ------------------------------------------------------ | -------------------------------------------------------------|
| `register --username <username> --password <password>` | зарегистрироваться                                           |
| `login --username <username> --password <password>`    | войти в аккаунт                                              |
| `buy --currency <currency> --amount <amount>`          | купить валюты `currency` в количестве `amount`               |
| `sell --currency <currency> --amount <amount>`         | продать валюты `currency` в количестве `amount`              |
| `show-portfolio [--base <base> = USD]`                 | показать портфель пользователя, все перевести в валюту `currency` |
| `get-rate --from <from currency> --to <to currency>`   | показать курс `from_v` -> `to`                               |
| `update-rates [--source <coingecko \| exchangerate>]`   | обновить курсы                                               |
|`show-rates --currency <str> --top <int> [--base <str>]`| вывести курсы, связанные с `currency`, `top` самых высоких курсов|
|`deposit --amount`                                      | пополнить кошелек базовой валюты                             |
|`logout`                                                | выйти из аккаунта                                            |
|`whoami`                                                | вывести данные текущего пользователя                         |
| `help`                                                 | справочная информация                                        |
| `exit`                                                 | выйти из программы                                           |

Поддерживаемые сейчас валюты (`currency`): `USD`, `RUB`, `CNY`, `EUR`, `BTC`, `ETH`, `SOL`.

## Хранилища данных
### `users.json`
Хранит информацию о зарегистрированных пользователях: их id, никнейм, хэш пароля, соль, дата регистрации

### `portfolio.json`
Хранит портфели пользователей: id пользователя и кошельки 

### `rates.json`
Хранит курсы и дату последнего обновления 

### `exchange_rates.json`
Хранит историю обновления курсов 

### `session.json`
Хранит id и ник последнего авторизованного пользователя

## Демонстрация работы

[![asciicast](https://asciinema.org/a/VmTOAMcATTKNBjMm.svg)](https://asciinema.org/a/VmTOAMcATTKNBjMm)
